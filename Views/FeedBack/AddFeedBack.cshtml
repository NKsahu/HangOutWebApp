
@{
    Layout = null;
}
<style>
    .SubItem {
        max-height: 250px;
        width: 100%;
        overflow-y: scroll;
        border:1px solid green;
    }
    .QueTitle{
        margin-top:20px;
    }
</style>
<div class="card row">
<div class="card-header">
<h3 class="text-center">FeedBack Form</h3>
</div>
<div class="card">
    <div class="row questions" style="display:none;border:1px solid black; " id="question0">
        <div class="col-md-5">
            <input type="text" class="form-control QueTitle" placeholder="Enter Question Title" />
        </div>
        <div class="col-md-1">
            <input type="checkbox" class="form-control QueStatus" />
        </div>
        <div class="col-md-6">
            <label> Response Type</label>
            <select class="form-control QuestionType" id="QuestionType" onchange="ShowObjective(this)">
                <option value="0">Star</option>
                <option value="1">Objective</option>
                <option value="2">Subjective</option>
                <option value="3">Like Dislike Ok</option>
            </select>
        </div>
        <div id="Objective" class="row SubItem" style="display:none">
            <div class="col-md-12">
                <select class="form-control OptionType">
                    <option value="0">Single Mode</option>
                    <option value="1">Multiple</option>
                </select>
            </div>
            <div class="col-md-12 SubQuestions">
                <input type="text" placeholder="Option" class="form-control SubQuestion" />
            </div>

            <button onclick="AddTitle(this)" style="width:10%;margin-left:45%;margin-right:45%;margin-top:5px;" class="btn btn-danger ">
                <i class="fas fa-plus-circle"></i>
            </button>
        </div>
    </div>
    <div class="col-md-12 SubQuestions" id="ObjectiveID" style="display:none">
        <input type="text" placeholder="Option" class="form-control SubQuestion" />
    </div>


                            <!--START DESIGN FROM HERE -->
    <div class="row" style="margin-bottom:10px;">
        <div class="col-md-8">
            <input type="text" class="form-control" placeholder="Form Name" id="FeedbackForm"/>
            <input type="hidden" id="FeedBkFormID" value="0" />
        </div>
        <div class="col-md-4">
            <input type="checkbox" class="form-control" id="FeedfackSts"/>
        </div>
    </div>
    <div class="row questions" id="question" style="border:1px solid black;">
        <div class="col-md-5">
            <input type="text" readonly value="ORDERED ITEM LIST" class="form-control QueTitle" placeholder="Enter Question Title" />
        </div>
        <div class="col-md-1">
            <input type="checkbox" class="form-control QueStatus" />
        </div>
        <div class="col-md-6">
            <label> Response Type</label>
            <select class="form-control QuestionType"  id="QuestionType" onchange="ShowObjective(this)">
                <option value="0">Star</option>
                <option value="3">Like Dislike Ok</option>
            </select>
        </div>
    </div>
    <div id="HeadDiv" style="display:none"></div>
    <button onclick="ShalloCopy()" class="btn btn-danger" style="margin-right:90%">
        <i class="fas fa-plus-circle"></i>
    </button>
    <button style="margin-top:10px;margin-right:90%" class="btn btn-success " onclick="Submit()">
        Submit
    </button>
</div>
</div>
<script>
    function ShalloCopy() {
        var ColyDiv = $("#question0").clone();
        ColyDiv.show();
        ColyDiv.insertBefore("#HeadDiv"); 
    }
    function AddTitle(event) {
        var SubItem = $("#ObjectiveID").clone();
        SubItem.show();
        SubItem.insertBefore($(event));
        //SubItem.insertBefore("#SubDiv");
    }
    function ShowObjective(event) {
        console.log("AAYA value=" + $(event).val());
        if ($(event).val() == "1") {
            $(event).parent('div').parent('div').find('.SubItem').show();
        }
        else {
            $(event).parent('div').parent('div').find('.SubItem').hide();
        }
       
    }
    function Submit() {
        var listQue = document.getElementsByClassName("questions");
        //start from i=0 skip first hidden copy div
        var FormName = $("#FeedbackForm").val();
        if (FormName == null || FormName == "") {
            alert("Enter Form Name");
            return;
        }
        var FormStatus = $("#FeedfackSts").is(':checked');
        var FeedBkFormID = $("#FeedBkFormID").val();
        var ObjFeedbkForm = {};
        ObjFeedbkForm.Id = FeedBkFormID;
        ObjFeedbkForm.Name = FormName;
        ObjFeedbkForm.OrgId = 0;
        ObjFeedbkForm.Status = FormStatus;
        var QuestionList = [];
        for (var i = 1; i < listQue.length; i++) {
            var ObjQue = $(listQue[i]);
            var QuestionTitle = ObjQue.find('.QueTitle').val();
            var QueStatus = ObjQue.find('.QueStatus').is(':checked');
            var QuestionType = ObjQue.find('.QuestionType').val();
            console.log("questions=" + QuestionTitle + "  Status=" + QueStatus + "Qtype=" + QuestionType);
            var ObjQues = {};
            ObjQues.Title = QuestionTitle;
            ObjQues.Status = QueStatus;
            ObjQues.QuestionType = QuestionType;
            ObjQues.FeedBkFormID = FeedBkFormID;
            
           // public int ID { get; set; }
           //  Check Is Objective
            if (QuestionType == "1") {
                var OptionType = ObjQue.find('.OptionType').val();
                var ObjectiveList = [];
                var ListSubQuestions = listQue[i].getElementsByClassName("SubQuestion");
                for (var j = 0; j < ListSubQuestions.length; j++) {
                    var option = ListSubQuestions[j].value;
                    console.log("value=" + option + " OptionType" + OptionType);
                    var FeedBkObjective = {};
                    FeedBkObjective.Name = option;
                    FeedBkObjective.ObjectiveType = OptionType;
                    ObjectiveList.push(FeedBkObjective);
                    //public int id { get; set; }
                   // public int QuestionId{ get; set; }
                }
                ObjQues.Objectives = ObjectiveList;
            }
            QuestionList.push(ObjQues);
        }
        ObjFeedbkForm.Questions = QuestionList;
        $('#waiting').show();
        $.ajax({
            type: 'POST',
            url: "/FeedBack/SaveFeedBack",
            data: JSON.stringify(ObjFeedbkForm),
            contentType: "application/json",
            success: function (data) {
                //var OMId = parseInt(data);
                //if (parseInt(OrderMenuObj.id) == 0) {
                //    $("#Menus").append('<block ondblclick="AddOrderMenu(' + OMId + ')" id=' + OMId + '>' + OMName + '</block>');
                //}
                hidedpt("AddOrderMenu");
                $('#waiting').hide();
            },
            error: function (jqXhr, textStatus, errorMessage) { // error callback
                $('#waiting').hide();
            }
        });
    }
</script>